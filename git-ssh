#!/usr/bin/env bash

_usage () {
  echo "git ssh <remote>"
  echo "git ssh <remote> command"
  echo "git ssh <remote> -t command"
  exit 1
}

# TODO: add support for git+ssh://
# TODO: add support for ssh://
_getRemoteHost () {
  git config remote."$1".url | cut -d: -f1
}

_getRemoteDirectory () {
  git config remote."$1".url | cut -d: -f2
}

case $1 in
  h|help|\?|-h|--help)
    _usage
    ;;
  *)
    remote="$1"
    shift
    ;;
esac

# TODO: add support for all other SSH options, especially -t and -T
case $1 in
  '') ssh $(_getRemoteHost "$remote") -t "cd $(_getRemoteDirectory "$remote") && exec "'${SHELL:-/bin/bash}';;
  *)  ssh $(_getRemoteHost "$remote") -t "cd $(_getRemoteDirectory "$remote") && $@";;
esac
